package integration

import (
	"encoding/hex"
	"fmt"
	"github.com/cosmos/cosmos-sdk/x/auth/signing"
	. "github.com/weichang-bianjie/msg-sdk/codec"
	"github.com/weichang-bianjie/msg-sdk/utils"
)

func (s IntegrationTestSuite) TestNft() {
	cases := []SubTest{
		{
			"IssueDenom",
			IssueDenom,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}

func IssueDenom(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)
	txBytes, err := hex.DecodeString("0ab9090ab6090a1a2f697269736d6f642e6e66742e4d7367497373756544656e6f6d1297090a07626f6e6466786c1adf087b2224736368656d61223a22687474703a2f2f6a736f6e2d736368656d612e6f72672f64726166742d30372f736368656d6123222c22246964223a22687474703a2f2f6578616d706c652e636f6d2f6e66742e736368656d612e6a736f6e222c2274797065223a226f626a656374222c2270726f70657274696573223a7b2276697369626c65223a7b2274797065223a22626f6f6c65616e227d2c227265706f7274223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b22686561646572223a7b2274797065223a226172726179222c226974656d73223a7b2274797065223a22737472696e67222c22756e697175654974656d73223a747275652c22656e756d223a5b22e58faae695b0222c22e98791e9a29d222c22e5b882e59cba222c22e580bae588b8e59381e7a78d222c22e69c9fe99990222c22e58f91e8a18ce4baba222c22e8af84e7baa7222c22e68a95e8b584e88085225d2c226d696e4974656d73223a317d7d2c2264617461223a7b2274797065223a226172726179222c226974656d73223a7b2274797065223a226172726179222c226974656d73223a7b2274797065223a22737472696e67227d2c226d696e4974656d73223a317d7d2c2266697865645f76616c75655f686561646572223a7b2274797065223a226172726179222c226974656d73223a7b2224726566223a22232f646566696e6974696f6e732f66697865645f76616c75655f686561646572227d7d2c2264617465223a7b2224726566223a22232f646566696e6974696f6e732f64617465227d2c22736f75726365223a7b2274797065223a226172726179222c226974656d73223a7b2274797065223a22737472696e67227d7d7d2c227265717569726564223a5b22686561646572222c2264617461222c2264617465225d7d7d2c227265717569726564223a5b2276697369626c65222c227265706f7274225d2c22646566696e6974696f6e73223a7b2264617465223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b227374617274223a7b2274797065223a22737472696e67222c227061747465726e223a225e5b302d395d7b347d2d5b302d395d7b327d2d5b302d395d7b327d24227d2c22656e64223a7b2274797065223a22737472696e67222c227061747465726e223a225e5b302d395d7b347d2d5b302d395d7b327d2d5b302d395d7b327d24227d2c2274797065223a7b2274797065223a22737472696e67222c22656e756d223a5b2244222c2257222c224d222c2259225d7d7d2c227265717569726564223a5b227374617274222c22656e64222c2274797065225d7d2c2266697865645f76616c75655f686561646572223a7b2274797065223a226f626a656374222c2270726f70657274696573223a7b22686561646572223a7b2274797065223a22737472696e67227d2c2276616c7565223a7b2274797065223a22737472696e67227d7d2c227265717569726564223a5b22686561646572222c2276616c7565225d7d7d7d222a69616131373664643074676e33386772706338687078666d776c36736c386a666d6b6e6567386d6b787212580a500a460a1f2f636f736d6f732e63727970746f2e736563703235366b312e5075624b657912230a21024a97355aa9722c455b269376c805ab5d966d55934e7860565a48bdf58470d7c812040a0208011829120410c09a0c1a401617c1bc6283dd1ff508cf8c09aafa614912e57c7e37ea0ce4146e4b72a757b905d91d5fa19d611d9c6262d62dd313087097054e427f1a853578cdb5d70513b0")
	if err != nil {
		fmt.Println(err.Error())
	}
	Tx, err := GetTxDecoder()(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx := Tx.(signing.Tx)
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Nft.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}
